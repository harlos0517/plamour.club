import{s as te,a as fe,n as q,r as Z,f as ie,t as ae}from"../chunks/scheduler.DhETzKN4.js";import{S as he,i as ce,e as I,s as U,c as S,a as V,d as y,j as M,b as A,p as D,f as z,g as E,y as R,n as K,t as J,h as X,z as p,A as P,k as Y}from"../chunks/index.Da2K5Kkp.js";function C(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}const de=async e=>await(await fetch(`https://cloud.plamour.club/data/12F00liFHAf4rvB6N7ZqjxdRyVAgA444bMzPEvyhr3Q8/${e}`)).json();function B(e,o,r){const n=e.slice();return n[21]=o[r].clue,n[22]=o[r].row,n[23]=o[r].col,n[24]=o,n[25]=r,n}function F(e,o,r){const n=e.slice();return n[22]=o[r],n[25]=r,n}function G(e,o,r){const n=e.slice();return n[27]=o[r],n[29]=r,n}function H(e){let o,r,n=e[1][e[25]][e[29]]+"",a,g,i,_;function b(){return e[12](e[25],e[29])}return{c(){o=I("div"),r=I("span"),a=J(n),g=U(),this.h()},l(c){o=S(c,"DIV",{class:!0,role:!0,tabindex:!0});var u=V(o);r=S(u,"SPAN",{});var l=V(r);a=X(l,n),l.forEach(y),g=M(u),u.forEach(y),this.h()},h(){A(o,"class","flex flex-start absolute items-center justify-center border border-gray-300 bg-black transition-colors svelte-1mli9ry"),A(o,"role","button"),A(o,"tabindex","0"),p(o,"bg-sky-950",(e[25]!==e[6].row||e[29]!==e[6].col)&&e[10](e[25],e[29],e[0][e[7]])),p(o,"bg-sky-800",e[25]===e[6].row&&e[29]===e[6].col),D(o,"top",e[25]*W+"px"),D(o,"left",e[29]*W+"px"),D(o,"width",W+1+"px"),D(o,"height",W+1+"px")},m(c,u){z(c,o,u),E(o,r),E(r,a),E(o,g),i||(_=[P(o,"click",b),P(o,"keydown",ue)],i=!0)},p(c,u){e=c,u&2&&n!==(n=e[1][e[25]][e[29]]+"")&&Y(a,n),u&1217&&p(o,"bg-sky-950",(e[25]!==e[6].row||e[29]!==e[6].col)&&e[10](e[25],e[29],e[0][e[7]])),u&64&&p(o,"bg-sky-800",e[25]===e[6].row&&e[29]===e[6].col)},d(c){c&&y(o),i=!1,Z(_)}}}function L(e){let o,r=e[27]&&H(e);return{c(){r&&r.c(),o=K()},l(n){r&&r.l(n),o=K()},m(n,a){r&&r.m(n,a),z(n,o,a)},p(n,a){n[27]?r?r.p(n,a):(r=H(n),r.c(),r.m(o.parentNode,o)):r&&(r.d(1),r=null)},d(n){n&&y(o),r&&r.d(n)}}}function Q(e){let o,r=C(e[22]),n=[];for(let a=0;a<r.length;a+=1)n[a]=L(G(e,r,a));return{c(){for(let a=0;a<n.length;a+=1)n[a].c();o=K()},l(a){for(let g=0;g<n.length;g+=1)n[g].l(a);o=K()},m(a,g){for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(a,g);z(a,o,g)},p(a,g){if(g&3299){r=C(a[22]);let i;for(i=0;i<r.length;i+=1){const _=G(a,r,i);n[i]?n[i].p(_,g):(n[i]=L(_),n[i].c(),n[i].m(o.parentNode,o))}for(;i<n.length;i+=1)n[i].d(1);n.length=r.length}},d(a){a&&y(o),R(n,a)}}}function T(e){let o,r,n=e[21]+"",a,g,i=e[25],_,b;const c=()=>e[13](o,i),u=()=>e[13](null,i);function l(){return e[14](e[25],e[22],e[23])}return{c(){o=I("div"),r=I("span"),a=J(n),g=U(),this.h()},l(s){o=S(s,"DIV",{class:!0,role:!0,tabindex:!0});var d=V(o);r=S(d,"SPAN",{});var h=V(r);a=X(h,n),h.forEach(y),g=M(d),d.forEach(y),this.h()},h(){A(o,"class","flex flex-row items-center my-4 p-4 rounded-md border-2 border-solid border-white/30 transition-colors first:mt-0 last:mb-0 svelte-1mli9ry"),A(o,"role","button"),A(o,"tabindex","0"),p(o,"bg-gray-800",e[25]===e[7]&&!e[2][e[25]]),p(o,"bg-gray-950",e[25]!==e[7]&&!e[2][e[25]]),p(o,"bg-green-950",e[25]!==e[7]&&e[2][e[25]]),p(o,"bg-green-800",e[25]===e[7]&&e[2][e[25]]),p(o,"hover:bg-gray-700",e[25]===e[7]&&!e[2][e[25]]),p(o,"hover:bg-gray-900",e[25]!==e[7]&&!e[2][e[25]]),p(o,"hover:bg-green-900",e[25]!==e[7]&&e[2][e[25]]),p(o,"hover:bg-green-700",e[25]===e[7]&&e[2][e[25]])},m(s,d){z(s,o,d),E(o,r),E(r,a),E(o,g),c(),_||(b=[P(o,"click",l),P(o,"keydown",we)],_=!0)},p(s,d){e=s,d&1&&n!==(n=e[21]+"")&&Y(a,n),i!==e[25]&&(u(),i=e[25],c()),d&132&&p(o,"bg-gray-800",e[25]===e[7]&&!e[2][e[25]]),d&132&&p(o,"bg-gray-950",e[25]!==e[7]&&!e[2][e[25]]),d&132&&p(o,"bg-green-950",e[25]!==e[7]&&e[2][e[25]]),d&132&&p(o,"bg-green-800",e[25]===e[7]&&e[2][e[25]]),d&132&&p(o,"hover:bg-gray-700",e[25]===e[7]&&!e[2][e[25]]),d&132&&p(o,"hover:bg-gray-900",e[25]!==e[7]&&!e[2][e[25]]),d&132&&p(o,"hover:bg-green-900",e[25]!==e[7]&&e[2][e[25]]),d&132&&p(o,"hover:bg-green-700",e[25]===e[7]&&e[2][e[25]])},d(s){s&&y(o),u(),_=!1,Z(b)}}}function ge(e){let o,r,n,a,g,i,_,b=C(e[5]),c=[];for(let s=0;s<b.length;s+=1)c[s]=Q(F(e,b,s));let u=C(e[0]),l=[];for(let s=0;s<u.length;s+=1)l[s]=T(B(e,u,s));return{c(){o=I("div"),r=I("div");for(let s=0;s<c.length;s+=1)c[s].c();n=U(),a=I("div"),g=I("div");for(let s=0;s<l.length;s+=1)l[s].c();this.h()},l(s){o=S(s,"DIV",{class:!0});var d=V(o);r=S(d,"DIV",{class:!0});var h=V(r);for(let m=0;m<c.length;m+=1)c[m].l(h);h.forEach(y),n=M(d),a=S(d,"DIV",{class:!0});var v=V(a);g=S(v,"DIV",{class:!0});var O=V(g);for(let m=0;m<l.length;m+=1)l[m].l(O);O.forEach(y),v.forEach(y),d.forEach(y),this.h()},h(){A(r,"class","relative flex-grow-0 m-8"),D(r,"width",W*e[4]+"px"),D(r,"height",W*e[3]+"px"),A(g,"class","overflow-auto pr-3"),D(g,"height","calc(100dvh - 64px)"),A(a,"class","flex-1 p-8 pl-0"),A(o,"class","h-dvh flex flex-row items-center justify-center")},m(s,d){z(s,o,d),E(o,r);for(let h=0;h<c.length;h+=1)c[h]&&c[h].m(r,null);E(o,n),E(o,a),E(a,g);for(let h=0;h<l.length;h+=1)l[h]&&l[h].m(g,null);i||(_=fe(e[9].call(null,o)),i=!0)},p(s,[d]){if(d&3299){b=C(s[5]);let h;for(h=0;h<b.length;h+=1){const v=F(s,b,h);c[h]?c[h].p(v,d):(c[h]=Q(v),c[h].c(),c[h].m(r,null))}for(;h<c.length;h+=1)c[h].d(1);c.length=b.length}if(d&16&&D(r,"width",W*s[4]+"px"),d&8&&D(r,"height",W*s[3]+"px"),d&453){u=C(s[0]);let h;for(h=0;h<u.length;h+=1){const v=B(s,u,h);l[h]?l[h].p(v,d):(l[h]=T(v),l[h].c(),l[h].m(g,null))}for(;h<l.length;h+=1)l[h].d(1);l.length=u.length}},i:q,o:q,d(s){s&&y(o),R(c,s),R(l,s),i=!1,_()}}}const W=24,ue=()=>{},we=()=>{};function pe(e,o,r){let n,a,g=!1,i=[],_=0,b=0,c=[],u=[];const l={row:0,col:0};let s=0,d=[];const h=async()=>{r(0,i=await de("CROSSWORD")),r(3,_=Math.max(...i.map(f=>f.direction==="down"?f.row+f.word.length-1:f.row))+1),r(4,b=Math.max(...i.map(f=>f.direction==="across"?f.col+f.word.length-1:f.col))+1),r(5,c=Array.from({length:_},()=>Array.from({length:b},()=>""))),r(1,u=Array.from({length:_},()=>Array.from({length:b},()=>""))),i.forEach(f=>{const{direction:t,row:w,col:k,word:N}=f;for(let j=0;j<N.length;j++){const ne=t==="down"?w+j:w,se=t==="across"?k+j:k;r(5,c[ne][se]=N[j].toUpperCase(),c)}}),r(6,l.row=i[0].row,l),r(6,l.col=i[0].col,l),r(8,d=Array.from({length:i.length},()=>null)),document.addEventListener("keydown",$)},v=f=>{g||(h(),g=!0)},O=(f,t,w)=>w.direction==="across"&&w.row===f&&w.col<=t&&t<w.col+w.word.length||w.direction==="down"&&w.col===t&&w.row<=f&&f<w.row+w.word.length,m=(f,t)=>{var N;const w=s,k=i.filter(j=>O(f,t,j));k.length===1&&r(7,s=i.indexOf(k[0])),k.length===2&&(f===l.row&&t===l.col?s===i.indexOf(k[0])?r(7,s=i.indexOf(k[1])):r(7,s=i.indexOf(k[0])):k.includes(i[s])||r(7,s=i.indexOf(k[0]))),r(6,l.row=f,l),r(6,l.col=t,l),s!==w&&d[s]&&((N=d[s])==null||N.scrollIntoView({block:"center",inline:"center",behavior:"smooth"}))},$=async f=>{if(!(f.altKey||f.ctrlKey||f.metaKey))if(f.preventDefault(),f.key==="ArrowUp"){let t=l.row;for(;t>0;)if(t--,c[t][l.col]){m(t,l.col);break}}else if(f.key==="ArrowDown"){let t=l.row;for(;t<_-1;)if(t++,c[t][l.col]){m(t,l.col);break}}else if(f.key==="ArrowLeft"){let t=l.col;for(;t>0;)if(t--,c[l.row][t]){m(l.row,t);break}}else if(f.key==="ArrowRight"){let t=l.col;for(;t<b-1;)if(t++,c[l.row][t]){m(l.row,t);break}}else if(f.key.length===1&&f.key.match(/[a-z_ ]/i)){r(1,u[l.row][l.col]=f.key===" "?"_":f.key.toUpperCase(),u);const t=i[s];t.direction==="across"&&l.col<t.col+t.word.length-1?r(6,l.col++,l):t.direction==="down"&&l.row<t.row+t.word.length-1&&r(6,l.row++,l),await ae(),a&&setTimeout(ee,10)}else if(f.key==="Backspace"){const t=u[l.row][l.col],w=i[s];w.direction==="across"&&l.col>w.col&&!t?r(6,l.col--,l):w.direction==="down"&&l.row>w.row&&!t&&r(6,l.row--,l),r(1,u[l.row][l.col]="",u)}else f.key==="Enter"&&m(l.row,l.col)},x=(f,t)=>t.direction==="across"?Array.from({length:t.word.length},(w,k)=>f[t.row][t.col+k]).join(""):Array.from({length:t.word.length},(w,k)=>f[t.row+k][t.col]).join(""),ee=()=>{alert(`恭喜！你完成了文字遊戲！
正在準備你的半週年禮物...
準備完成！按下確認以接受禮物！`),window.location.href="/?key=plamour-half-anniversary"},oe=(f,t)=>m(f,t);function re(f,t){ie[f?"unshift":"push"](()=>{d[t]=f,r(8,d)})}const le=(f,t,w)=>{r(7,s=f),r(6,l.row=t,l),r(6,l.col=w,l)};return e.$$.update=()=>{e.$$.dirty&3&&r(2,n=i.map(f=>x(u,f)===f.word.toUpperCase())),e.$$.dirty&4&&(a=n.every(f=>f))},[i,u,n,_,b,c,l,s,d,v,O,m,oe,re,le]}class me extends he{constructor(o){super(),ce(this,o,pe,ge,te,{})}}export{me as component};
