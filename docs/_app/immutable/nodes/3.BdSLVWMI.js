import{s as te,f as fe,n as F,r as X,e as ie,t as he}from"../chunks/scheduler.DCNtzCSl.js";import{S as ae,i as ce,e as C,s as R,b as S,f as V,d as k,g as M,o as A,p as D,a as U,h as E,y as P,m as z,t as Y,c as $,z as p,A as K,j as x}from"../chunks/index.4NXwMCL5.js";function O(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}const de=async e=>await(await fetch(`https://cloud.plamour.club/data/12F00liFHAf4rvB6N7ZqjxdRyVAgA444bMzPEvyhr3Q8/${e}`)).json();function G(e,o,r){const n=e.slice();return n[21]=o[r].clue,n[22]=o[r].row,n[23]=o[r].col,n[24]=o,n[25]=r,n}function H(e,o,r){const n=e.slice();return n[22]=o[r],n[25]=r,n}function L(e,o,r){const n=e.slice();return n[27]=o[r],n[29]=r,n}function Q(e){let o,r,n=e[1][e[25]][e[29]]+"",h,u,i,_;function b(){return e[12](e[25],e[29])}return{c(){o=C("div"),r=C("span"),h=Y(n),u=R(),this.h()},l(c){o=S(c,"DIV",{class:!0,role:!0,tabindex:!0});var g=V(o);r=S(g,"SPAN",{});var l=V(r);h=$(l,n),l.forEach(k),u=M(g),g.forEach(k),this.h()},h(){A(o,"class","flex flex-start absolute items-center justify-center border border-gray-300 bg-black transition-colors svelte-1mli9ry"),A(o,"role","button"),A(o,"tabindex","0"),p(o,"bg-sky-950",(e[25]!==e[6].row||e[29]!==e[6].col)&&e[10](e[25],e[29],e[0][e[7]])),p(o,"bg-sky-800",e[25]===e[6].row&&e[29]===e[6].col),D(o,"top",e[25]*W+"px"),D(o,"left",e[29]*W+"px"),D(o,"width",W+1+"px"),D(o,"height",W+1+"px")},m(c,g){U(c,o,g),E(o,r),E(r,h),E(o,u),i||(_=[K(o,"click",b),K(o,"keydown",ue)],i=!0)},p(c,g){e=c,g&2&&n!==(n=e[1][e[25]][e[29]]+"")&&x(h,n),g&1217&&p(o,"bg-sky-950",(e[25]!==e[6].row||e[29]!==e[6].col)&&e[10](e[25],e[29],e[0][e[7]])),g&64&&p(o,"bg-sky-800",e[25]===e[6].row&&e[29]===e[6].col)},d(c){c&&k(o),i=!1,X(_)}}}function T(e){let o,r=e[27]&&Q(e);return{c(){r&&r.c(),o=z()},l(n){r&&r.l(n),o=z()},m(n,h){r&&r.m(n,h),U(n,o,h)},p(n,h){n[27]?r?r.p(n,h):(r=Q(n),r.c(),r.m(o.parentNode,o)):r&&(r.d(1),r=null)},d(n){n&&k(o),r&&r.d(n)}}}function Z(e){let o,r=O(e[22]),n=[];for(let h=0;h<r.length;h+=1)n[h]=T(L(e,r,h));return{c(){for(let h=0;h<n.length;h+=1)n[h].c();o=z()},l(h){for(let u=0;u<n.length;u+=1)n[u].l(h);o=z()},m(h,u){for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(h,u);U(h,o,u)},p(h,u){if(u&3299){r=O(h[22]);let i;for(i=0;i<r.length;i+=1){const _=L(h,r,i);n[i]?n[i].p(_,u):(n[i]=T(_),n[i].c(),n[i].m(o.parentNode,o))}for(;i<n.length;i+=1)n[i].d(1);n.length=r.length}},d(h){h&&k(o),P(n,h)}}}function J(e){let o,r,n=e[21]+"",h,u,i=e[25],_,b;const c=()=>e[13](o,i),g=()=>e[13](null,i);function l(){return e[14](e[25],e[22],e[23])}return{c(){o=C("div"),r=C("span"),h=Y(n),u=R(),this.h()},l(s){o=S(s,"DIV",{class:!0,role:!0,tabindex:!0});var d=V(o);r=S(d,"SPAN",{});var a=V(r);h=$(a,n),a.forEach(k),u=M(d),d.forEach(k),this.h()},h(){A(o,"class","flex flex-row items-center my-4 p-4 rounded-md border-2 border-solid border-white/30 transition-colors first:mt-0 last:mb-0 svelte-1mli9ry"),A(o,"role","button"),A(o,"tabindex","0"),p(o,"bg-gray-700",e[25]===e[7]&&!e[2][e[25]]),p(o,"bg-gray-900",e[25]!==e[7]&&!e[2][e[25]]),p(o,"bg-green-900",e[25]!==e[7]&&e[2][e[25]]),p(o,"bg-green-700",e[25]===e[7]&&e[2][e[25]]),p(o,"hover:bg-gray-600",e[25]===e[7]&&!e[2][e[25]]),p(o,"hover:bg-gray-800",e[25]!==e[7]&&!e[2][e[25]]),p(o,"hover:bg-green-800",e[25]!==e[7]&&e[2][e[25]]),p(o,"hover:bg-green-600",e[25]===e[7]&&e[2][e[25]])},m(s,d){U(s,o,d),E(o,r),E(r,h),E(o,u),c(),_||(b=[K(o,"click",l),K(o,"keydown",we)],_=!0)},p(s,d){e=s,d&1&&n!==(n=e[21]+"")&&x(h,n),i!==e[25]&&(g(),i=e[25],c()),d&132&&p(o,"bg-gray-700",e[25]===e[7]&&!e[2][e[25]]),d&132&&p(o,"bg-gray-900",e[25]!==e[7]&&!e[2][e[25]]),d&132&&p(o,"bg-green-900",e[25]!==e[7]&&e[2][e[25]]),d&132&&p(o,"bg-green-700",e[25]===e[7]&&e[2][e[25]]),d&132&&p(o,"hover:bg-gray-600",e[25]===e[7]&&!e[2][e[25]]),d&132&&p(o,"hover:bg-gray-800",e[25]!==e[7]&&!e[2][e[25]]),d&132&&p(o,"hover:bg-green-800",e[25]!==e[7]&&e[2][e[25]]),d&132&&p(o,"hover:bg-green-600",e[25]===e[7]&&e[2][e[25]])},d(s){s&&k(o),g(),_=!1,X(b)}}}function ge(e){let o,r,n,h,u,i,_,b=O(e[5]),c=[];for(let s=0;s<b.length;s+=1)c[s]=Z(H(e,b,s));let g=O(e[0]),l=[];for(let s=0;s<g.length;s+=1)l[s]=J(G(e,g,s));return{c(){o=C("div"),r=C("div");for(let s=0;s<c.length;s+=1)c[s].c();n=R(),h=C("div"),u=C("div");for(let s=0;s<l.length;s+=1)l[s].c();this.h()},l(s){o=S(s,"DIV",{class:!0});var d=V(o);r=S(d,"DIV",{class:!0});var a=V(r);for(let m=0;m<c.length;m+=1)c[m].l(a);a.forEach(k),n=M(d),h=S(d,"DIV",{class:!0});var v=V(h);u=S(v,"DIV",{class:!0});var N=V(u);for(let m=0;m<l.length;m+=1)l[m].l(N);N.forEach(k),v.forEach(k),d.forEach(k),this.h()},h(){A(r,"class","relative flex-grow-0 m-8"),D(r,"width",W*e[4]+"px"),D(r,"height",W*e[3]+"px"),A(u,"class","overflow-auto pr-3"),D(u,"height","calc(100dvh - 64px)"),A(h,"class","flex-1 p-8 pl-0"),A(o,"class","h-dvh flex flex-row items-center justify-center")},m(s,d){U(s,o,d),E(o,r);for(let a=0;a<c.length;a+=1)c[a]&&c[a].m(r,null);E(o,n),E(o,h),E(h,u);for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(u,null);i||(_=fe(e[9].call(null,o)),i=!0)},p(s,[d]){if(d&3299){b=O(s[5]);let a;for(a=0;a<b.length;a+=1){const v=H(s,b,a);c[a]?c[a].p(v,d):(c[a]=Z(v),c[a].c(),c[a].m(r,null))}for(;a<c.length;a+=1)c[a].d(1);c.length=b.length}if(d&16&&D(r,"width",W*s[4]+"px"),d&8&&D(r,"height",W*s[3]+"px"),d&453){g=O(s[0]);let a;for(a=0;a<g.length;a+=1){const v=G(s,g,a);l[a]?l[a].p(v,d):(l[a]=J(v),l[a].c(),l[a].m(u,null))}for(;a<l.length;a+=1)l[a].d(1);l.length=g.length}},i:F,o:F,d(s){s&&k(o),P(c,s),P(l,s),i=!1,_()}}}const W=24,ue=()=>{},we=()=>{};function pe(e,o,r){let n,h,u=!1,i=[],_=0,b=0,c=[],g=[];const l={row:0,col:0};let s=0,d=[];const a=async()=>{r(0,i=await de("CROSSWORD")),r(3,_=Math.max(...i.map(f=>f.direction==="down"?f.row+f.word.length-1:f.row))+1),r(4,b=Math.max(...i.map(f=>f.direction==="across"?f.col+f.word.length-1:f.col))+1),r(5,c=Array.from({length:_},()=>Array.from({length:b},()=>""))),r(1,g=Array.from({length:_},()=>Array.from({length:b},()=>""))),i.forEach(f=>{const{direction:t,row:w,col:y,word:j}=f;for(let I=0;I<j.length;I++){const q=t==="down"?w+I:w,B=t==="across"?y+I:y;r(5,c[q][B]=j[I].toUpperCase(),c),r(1,g[q][B]=j[I].toUpperCase(),g)}}),r(6,l.row=i[0].row,l),r(6,l.col=i[0].col,l),r(8,d=Array.from({length:i.length},()=>null)),document.addEventListener("keydown",ee)},v=f=>{u||(a(),u=!0)},N=(f,t,w)=>w.direction==="across"&&w.row===f&&w.col<=t&&t<w.col+w.word.length||w.direction==="down"&&w.col===t&&w.row<=f&&f<w.row+w.word.length,m=(f,t)=>{var j;const w=s,y=i.filter(I=>N(f,t,I));y.length===1&&r(7,s=i.indexOf(y[0])),y.length===2&&(f===l.row&&t===l.col?s===i.indexOf(y[0])?r(7,s=i.indexOf(y[1])):r(7,s=i.indexOf(y[0])):y.includes(i[s])||r(7,s=i.indexOf(y[0]))),r(6,l.row=f,l),r(6,l.col=t,l),s!==w&&d[s]&&((j=d[s])==null||j.scrollIntoView({block:"center",inline:"center",behavior:"smooth"}))},ee=async f=>{if(!(f.altKey||f.ctrlKey||f.metaKey))if(f.preventDefault(),f.key==="ArrowUp"){let t=l.row;for(;t>0;)if(t--,c[t][l.col]){m(t,l.col);break}}else if(f.key==="ArrowDown"){let t=l.row;for(;t<_-1;)if(t++,c[t][l.col]){m(t,l.col);break}}else if(f.key==="ArrowLeft"){let t=l.col;for(;t>0;)if(t--,c[l.row][t]){m(l.row,t);break}}else if(f.key==="ArrowRight"){let t=l.col;for(;t<b-1;)if(t++,c[l.row][t]){m(l.row,t);break}}else if(f.key.length===1&&f.key.match(/[a-z_ ]/i)){r(1,g[l.row][l.col]=f.key===" "?"_":f.key.toUpperCase(),g);const t=i[s];t.direction==="across"&&l.col<t.col+t.word.length-1?r(6,l.col++,l):t.direction==="down"&&l.row<t.row+t.word.length-1&&r(6,l.row++,l),await he(),h&&setTimeout(re,10)}else if(f.key==="Backspace"){const t=g[l.row][l.col],w=i[s];w.direction==="across"&&l.col>w.col&&!t?r(6,l.col--,l):w.direction==="down"&&l.row>w.row&&!t&&r(6,l.row--,l),r(1,g[l.row][l.col]="",g)}else f.key==="Enter"&&m(l.row,l.col)},oe=(f,t)=>t.direction==="across"?Array.from({length:t.word.length},(w,y)=>f[t.row][t.col+y]).join(""):Array.from({length:t.word.length},(w,y)=>f[t.row+y][t.col]).join(""),re=()=>{alert(`恭喜！你完成了文字遊戲！
正在準備你的半週年禮物...
準備完成！按下確認以接受禮物！`),window.location.href="/?key=plamour-half-anniversary"},le=(f,t)=>m(f,t);function ne(f,t){ie[f?"unshift":"push"](()=>{d[t]=f,r(8,d)})}const se=(f,t,w)=>{r(7,s=f),r(6,l.row=t,l),r(6,l.col=w,l)};return e.$$.update=()=>{e.$$.dirty&3&&r(2,n=i.map(f=>oe(g,f)===f.word.toUpperCase())),e.$$.dirty&4&&(h=n.every(f=>f))},[i,g,n,_,b,c,l,s,d,v,N,m,le,ne,se]}class me extends ae{constructor(o){super(),ce(this,o,pe,ge,te,{})}}export{me as component};
