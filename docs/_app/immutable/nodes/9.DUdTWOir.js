import{s as ie,a as te,n as G,r as Q,f as ae,t as fe}from"../chunks/scheduler.qAf2VIfS.js";import{S as he,i as ce,e as I,l as q,c as S,a as W,d as y,m as z,b as A,s as E,f as N,n as D,o as R,w as U,p as X,q as Y,r as _,u as P,v as Z}from"../chunks/index.Dn_sawV-.js";import{e as V}from"../chunks/each.D6YF6ztN.js";import{f as de}from"../chunks/index.DpDqtowM.js";function L(e,o,r){const n=e.slice();return n[21]=o[r].clue,n[22]=o[r].row,n[23]=o[r].col,n[24]=o,n[25]=r,n}function M(e,o,r){const n=e.slice();return n[22]=o[r],n[25]=r,n}function B(e,o,r){const n=e.slice();return n[27]=o[r],n[29]=r,n}function H(e){let o,r,n=e[1][e[25]][e[29]]+"",f,g,a,p;function b(){return e[12](e[25],e[29])}return{c(){o=I("div"),r=I("span"),f=X(n),g=q(),this.h()},l(c){o=S(c,"DIV",{class:!0,role:!0,tabindex:!0});var u=W(o);r=S(u,"SPAN",{});var l=W(r);f=Y(l,n),l.forEach(y),g=z(u),u.forEach(y),this.h()},h(){A(o,"class","flex flex-start absolute items-center justify-center border border-gray-300 bg-black transition-colors svelte-1mli9ry"),A(o,"role","button"),A(o,"tabindex","0"),_(o,"bg-sky-950",(e[25]!==e[6].row||e[29]!==e[6].col)&&e[10](e[25],e[29],e[0][e[7]])),_(o,"bg-sky-800",e[25]===e[6].row&&e[29]===e[6].col),E(o,"top",e[25]*C+"px"),E(o,"left",e[29]*C+"px"),E(o,"width",C+1+"px"),E(o,"height",C+1+"px")},m(c,u){N(c,o,u),D(o,r),D(r,f),D(o,g),a||(p=[P(o,"click",b),P(o,"keydown",ue)],a=!0)},p(c,u){e=c,u&2&&n!==(n=e[1][e[25]][e[29]]+"")&&Z(f,n),u&1217&&_(o,"bg-sky-950",(e[25]!==e[6].row||e[29]!==e[6].col)&&e[10](e[25],e[29],e[0][e[7]])),u&64&&_(o,"bg-sky-800",e[25]===e[6].row&&e[29]===e[6].col)},d(c){c&&y(o),a=!1,Q(p)}}}function T(e){let o,r=e[27]&&H(e);return{c(){r&&r.c(),o=U()},l(n){r&&r.l(n),o=U()},m(n,f){r&&r.m(n,f),N(n,o,f)},p(n,f){n[27]?r?r.p(n,f):(r=H(n),r.c(),r.m(o.parentNode,o)):r&&(r.d(1),r=null)},d(n){n&&y(o),r&&r.d(n)}}}function F(e){let o,r=V(e[22]),n=[];for(let f=0;f<r.length;f+=1)n[f]=T(B(e,r,f));return{c(){for(let f=0;f<n.length;f+=1)n[f].c();o=U()},l(f){for(let g=0;g<n.length;g+=1)n[g].l(f);o=U()},m(f,g){for(let a=0;a<n.length;a+=1)n[a]&&n[a].m(f,g);N(f,o,g)},p(f,g){if(g&3299){r=V(f[22]);let a;for(a=0;a<r.length;a+=1){const p=B(f,r,a);n[a]?n[a].p(p,g):(n[a]=T(p),n[a].c(),n[a].m(o.parentNode,o))}for(;a<n.length;a+=1)n[a].d(1);n.length=r.length}},d(f){f&&y(o),R(n,f)}}}function J(e){let o,r,n=e[21]+"",f,g,a=e[25],p,b;const c=()=>e[13](o,a),u=()=>e[13](null,a);function l(){return e[14](e[25],e[22],e[23])}return{c(){o=I("div"),r=I("span"),f=X(n),g=q(),this.h()},l(s){o=S(s,"DIV",{class:!0,role:!0,tabindex:!0});var d=W(o);r=S(d,"SPAN",{});var h=W(r);f=Y(h,n),h.forEach(y),g=z(d),d.forEach(y),this.h()},h(){A(o,"class","flex flex-row items-center my-4 p-4 rounded-md border-2 border-solid border-white/30 transition-colors first:mt-0 last:mb-0 svelte-1mli9ry"),A(o,"role","button"),A(o,"tabindex","0"),_(o,"bg-gray-800",e[25]===e[7]&&!e[2][e[25]]),_(o,"bg-gray-950",e[25]!==e[7]&&!e[2][e[25]]),_(o,"bg-green-950",e[25]!==e[7]&&e[2][e[25]]),_(o,"bg-green-800",e[25]===e[7]&&e[2][e[25]]),_(o,"hover:bg-gray-700",e[25]===e[7]&&!e[2][e[25]]),_(o,"hover:bg-gray-900",e[25]!==e[7]&&!e[2][e[25]]),_(o,"hover:bg-green-900",e[25]!==e[7]&&e[2][e[25]]),_(o,"hover:bg-green-700",e[25]===e[7]&&e[2][e[25]])},m(s,d){N(s,o,d),D(o,r),D(r,f),D(o,g),c(),p||(b=[P(o,"click",l),P(o,"keydown",we)],p=!0)},p(s,d){e=s,d&1&&n!==(n=e[21]+"")&&Z(f,n),a!==e[25]&&(u(),a=e[25],c()),d&132&&_(o,"bg-gray-800",e[25]===e[7]&&!e[2][e[25]]),d&132&&_(o,"bg-gray-950",e[25]!==e[7]&&!e[2][e[25]]),d&132&&_(o,"bg-green-950",e[25]!==e[7]&&e[2][e[25]]),d&132&&_(o,"bg-green-800",e[25]===e[7]&&e[2][e[25]]),d&132&&_(o,"hover:bg-gray-700",e[25]===e[7]&&!e[2][e[25]]),d&132&&_(o,"hover:bg-gray-900",e[25]!==e[7]&&!e[2][e[25]]),d&132&&_(o,"hover:bg-green-900",e[25]!==e[7]&&e[2][e[25]]),d&132&&_(o,"hover:bg-green-700",e[25]===e[7]&&e[2][e[25]])},d(s){s&&y(o),u(),p=!1,Q(b)}}}function ge(e){let o,r,n,f,g,a,p,b=V(e[5]),c=[];for(let s=0;s<b.length;s+=1)c[s]=F(M(e,b,s));let u=V(e[0]),l=[];for(let s=0;s<u.length;s+=1)l[s]=J(L(e,u,s));return{c(){o=I("div"),r=I("div");for(let s=0;s<c.length;s+=1)c[s].c();n=q(),f=I("div"),g=I("div");for(let s=0;s<l.length;s+=1)l[s].c();this.h()},l(s){o=S(s,"DIV",{class:!0});var d=W(o);r=S(d,"DIV",{class:!0});var h=W(r);for(let m=0;m<c.length;m+=1)c[m].l(h);h.forEach(y),n=z(d),f=S(d,"DIV",{class:!0});var v=W(f);g=S(v,"DIV",{class:!0});var j=W(g);for(let m=0;m<l.length;m+=1)l[m].l(j);j.forEach(y),v.forEach(y),d.forEach(y),this.h()},h(){A(r,"class","relative flex-grow-0 m-8"),E(r,"width",C*e[4]+"px"),E(r,"height",C*e[3]+"px"),A(g,"class","overflow-auto pr-3"),E(g,"height","calc(100dvh - 64px)"),A(f,"class","flex-1 p-8 pl-0"),A(o,"class","h-dvh flex flex-row items-center justify-center")},m(s,d){N(s,o,d),D(o,r);for(let h=0;h<c.length;h+=1)c[h]&&c[h].m(r,null);D(o,n),D(o,f),D(f,g);for(let h=0;h<l.length;h+=1)l[h]&&l[h].m(g,null);a||(p=te(e[9].call(null,o)),a=!0)},p(s,[d]){if(d&3299){b=V(s[5]);let h;for(h=0;h<b.length;h+=1){const v=M(s,b,h);c[h]?c[h].p(v,d):(c[h]=F(v),c[h].c(),c[h].m(r,null))}for(;h<c.length;h+=1)c[h].d(1);c.length=b.length}if(d&16&&E(r,"width",C*s[4]+"px"),d&8&&E(r,"height",C*s[3]+"px"),d&453){u=V(s[0]);let h;for(h=0;h<u.length;h+=1){const v=L(s,u,h);l[h]?l[h].p(v,d):(l[h]=J(v),l[h].c(),l[h].m(g,null))}for(;h<l.length;h+=1)l[h].d(1);l.length=u.length}},i:G,o:G,d(s){s&&y(o),R(c,s),R(l,s),a=!1,p()}}}const C=24,ue=()=>{},we=()=>{};function _e(e,o,r){let n,f,g=!1,a=[],p=0,b=0,c=[],u=[];const l={row:0,col:0};let s=0,d=[];const h=async()=>{r(0,a=await de("CROSSWORD")),r(3,p=Math.max(...a.map(t=>t.direction==="down"?t.row+t.word.length-1:t.row))+1),r(4,b=Math.max(...a.map(t=>t.direction==="across"?t.col+t.word.length-1:t.col))+1),r(5,c=Array.from({length:p},()=>Array.from({length:b},()=>""))),r(1,u=Array.from({length:p},()=>Array.from({length:b},()=>""))),a.forEach(t=>{const{direction:i,row:w,col:k,word:K}=t;for(let O=0;O<K.length;O++){const ne=i==="down"?w+O:w,se=i==="across"?k+O:k;r(5,c[ne][se]=K[O].toUpperCase(),c)}}),r(6,l.row=a[0].row,l),r(6,l.col=a[0].col,l),r(8,d=Array.from({length:a.length},()=>null)),document.addEventListener("keydown",$)},v=t=>{g||(h(),g=!0)},j=(t,i,w)=>w.direction==="across"&&w.row===t&&w.col<=i&&i<w.col+w.word.length||w.direction==="down"&&w.col===i&&w.row<=t&&t<w.row+w.word.length,m=(t,i)=>{var K;const w=s,k=a.filter(O=>j(t,i,O));k.length===1&&r(7,s=a.indexOf(k[0])),k.length===2&&(t===l.row&&i===l.col?s===a.indexOf(k[0])?r(7,s=a.indexOf(k[1])):r(7,s=a.indexOf(k[0])):k.includes(a[s])||r(7,s=a.indexOf(k[0]))),r(6,l.row=t,l),r(6,l.col=i,l),s!==w&&d[s]&&((K=d[s])==null||K.scrollIntoView({block:"center",inline:"center",behavior:"smooth"}))},$=async t=>{if(!(t.altKey||t.ctrlKey||t.metaKey))if(t.preventDefault(),t.key==="ArrowUp"){let i=l.row;for(;i>0;)if(i--,c[i][l.col]){m(i,l.col);break}}else if(t.key==="ArrowDown"){let i=l.row;for(;i<p-1;)if(i++,c[i][l.col]){m(i,l.col);break}}else if(t.key==="ArrowLeft"){let i=l.col;for(;i>0;)if(i--,c[l.row][i]){m(l.row,i);break}}else if(t.key==="ArrowRight"){let i=l.col;for(;i<b-1;)if(i++,c[l.row][i]){m(l.row,i);break}}else if(t.key.length===1&&t.key.match(/[a-z_ ]/i)){r(1,u[l.row][l.col]=t.key===" "?"_":t.key.toUpperCase(),u);const i=a[s];i.direction==="across"&&l.col<i.col+i.word.length-1?r(6,l.col++,l):i.direction==="down"&&l.row<i.row+i.word.length-1&&r(6,l.row++,l),await fe(),f&&setTimeout(ee,10)}else if(t.key==="Backspace"){const i=u[l.row][l.col],w=a[s];w.direction==="across"&&l.col>w.col&&!i?r(6,l.col--,l):w.direction==="down"&&l.row>w.row&&!i&&r(6,l.row--,l),r(1,u[l.row][l.col]="",u)}else t.key==="Enter"&&m(l.row,l.col)},x=(t,i)=>i.direction==="across"?Array.from({length:i.word.length},(w,k)=>t[i.row][i.col+k]).join(""):Array.from({length:i.word.length},(w,k)=>t[i.row+k][i.col]).join(""),ee=()=>{alert(`恭喜！你完成了文字遊戲！
正在準備你的半週年禮物...
準備完成！按下確認以接受禮物！`),window.location.href="/?key=plamour-half-anniversary"},oe=(t,i)=>m(t,i);function re(t,i){ae[t?"unshift":"push"](()=>{d[i]=t,r(8,d)})}const le=(t,i,w)=>{r(7,s=t),r(6,l.row=i,l),r(6,l.col=w,l)};return e.$$.update=()=>{e.$$.dirty&3&&r(2,n=a.map(t=>x(u,t)===t.word.toUpperCase())),e.$$.dirty&4&&(f=n.every(t=>t))},[a,u,n,p,b,c,l,s,d,v,j,m,oe,re,le]}class ye extends he{constructor(o){super(),ce(this,o,_e,ge,ie,{})}}export{ye as component};
